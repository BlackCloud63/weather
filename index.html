<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horry County Weather - Hunters Ridge</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #2563eb;
            --dark-blue: #1e40af;
            --alert-red: #dc2626;
            --alert-orange: #ea580c;
            --alert-yellow: #eab308;
            --bg-gray: #f8fafc;
            --card-bg: #ffffff;
            --text-dark: #1e293b;
            --text-medium: #64748b;
            --border: #e2e8f0;
            --temp-high: #ef4444;
            --temp-low: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gray);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .alert-banner {
            background: var(--alert-red);
            color: white;
            padding: 1.25rem 1.5rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .alert-banner.active { display: block; }
        .alert-banner.warning { background: var(--alert-orange); }
        .alert-banner.watch { background: var(--alert-yellow); color: var(--text-dark); }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 1rem;
        }

        .quick-stats {
            background: white;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quick-stat {
            text-align: center;
        }

        .quick-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .quick-stat-label {
            font-size: 0.85rem;
            color: var(--text-medium);
            text-transform: uppercase;
            font-weight: 600;
        }

        .site-header {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }

        .site-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.25rem;
        }

        .site-subtitle {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .emergency-section {
            background: #fee2e2;
            border-left: 4px solid var(--alert-red);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            display: none;
        }

        .emergency-section.active { display: block; }

        .emergency-title {
            font-weight: 700;
            color: var(--alert-red);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .emergency-content {
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .emergency-links {
            margin-top: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .emergency-link {
            display: inline-block;
            background: var(--alert-red);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .emergency-link:hover { 
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .commentary-section {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white;
            border-radius: 12px;
            padding: 2rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
        }

        .commentary-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .commentary-author {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 1.25rem;
            font-style: italic;
        }

        .commentary-display {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid white;
            border-radius: 8px;
            padding: 1.25rem;
            display: none;
        }

        .commentary-display.active { display: block; }

        .commentary-timestamp {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .commentary-text {
            font-size: 1.05rem;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .no-commentary {
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            font-size: 0.95rem;
        }

        .share-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.2s;
            font-size: 0.95rem;
        }

        .share-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 1.25rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary-blue);
            text-align: center;
        }

        .station-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .station-frame {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 8px;
            background: white;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .forecast-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 0.85rem;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .forecast-card:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .forecast-day {
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .forecast-icon {
            font-size: 2rem;
            margin: 0.25rem 0;
        }

        .forecast-temps {
            font-weight: 700;
            font-size: 1rem;
            margin: 0.5rem 0;
        }

        .temp-high { color: var(--temp-high); }
        .temp-low { color: var(--temp-low); }

        .forecast-desc {
            font-size: 0.85rem;
            color: var(--text-medium);
            margin-top: 0.25rem;
        }

        .radar-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .radar-embed {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 8px;
        }

        .astronomy-strip {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 0.85rem 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .astro-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .astro-icon {
            font-size: 1.25rem;
        }

        .astro-label {
            font-weight: 600;
            color: var(--text-medium);
        }

        .astro-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        .astro-link {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 600;
        }

        .astro-link:hover {
            text-decoration: underline;
        }

        .admin-toggle {
            text-align: center;
            margin: 1.5rem 0;
        }

        .admin-toggle-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.65rem 1.25rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.85rem;
        }

        .admin-toggle-btn:hover { background: var(--dark-blue); }

        .admin-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 2px solid var(--primary-blue);
            display: none;
        }

        .admin-panel.active { display: block; }

        .admin-login {
            text-align: center;
            padding: 1rem;
        }

        .admin-login h3 {
            font-family: 'Space Grotesk', sans-serif;
            color: var(--text-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .admin-input {
            padding: 0.65rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            width: 280px;
            max-width: 100%;
            margin-bottom: 0.75rem;
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .admin-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.65rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }

        .admin-btn:hover { background: var(--dark-blue); }

        .admin-controls { display: none; }
        .admin-controls.active { display: block; }

        .admin-section {
            background: var(--bg-gray);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .admin-section h4 {
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .admin-textarea {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 0.75rem;
        }

        .admin-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .admin-select {
            width: 100%;
            padding: 0.65rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .loading {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        .site-footer {
            text-align: center;
            color: var(--text-medium);
            font-size: 0.85rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            margin-top: 1rem;
        }

        .last-updated {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .container { padding: 0.75rem; }
            .site-title { font-size: 1.25rem; }
            .commentary-title { font-size: 1.25rem; }
            .section-title { font-size: 1.15rem; }
            .station-container { padding: 0.5rem; }
            .station-frame { height: 450px; }
            .radar-embed { height: 500px; }
            .quick-stats { padding: 0.75rem 1rem; }
            .quick-stat-value { font-size: 1.5rem; }
            .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem; }
            .forecast-card { padding: 0.65rem; }
            .forecast-icon { font-size: 1.75rem; }
            .forecast-temps { font-size: 0.95rem; }
            .astro-item { font-size: 0.8rem; }
            .emergency-section { padding: 1rem; }
            .commentary-section { padding: 1.5rem 1.25rem; }
        }
    </style>
</head>
<body>
    <div id="alertBanner" class="alert-banner"></div>

    <div class="container">
        <section class="commentary-section">
            <h2 class="commentary-title">Severe Weather Analysis - What to Expect</h2>
            <div id="commentaryDisplay" class="commentary-display">
                <div class="commentary-timestamp" id="commentaryTime"></div>
                <div class="commentary-text" id="commentaryText"></div>
            </div>
            <p class="no-commentary" id="noCommentary">No current weather updates. Check back during active weather events.</p>
        </section>

        <div>
            <h2 class="section-title">Current Conditions - Myrtle Beach Airport</h2>
            <div class="quick-stats" id="quickStats">
                <div class="quick-stat">
                    <div class="quick-stat-value" id="quickTemp">--¬∞</div>
                    <div class="quick-stat-label">Temperature</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="quickConditions">--</div>
                    <div class="quick-stat-label">Conditions</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="quickWind">-- mph</div>
                    <div class="quick-stat-label">Wind</div>
                </div>
            </div>
            <p style="text-align: center; font-size: 0.75rem; color: var(--text-medium); margin-top: -0.5rem; margin-bottom: 1.5rem;"><em>Data from KMYR - updates hourly</em></p>
        </div>

        <div class="emergency-section" id="schoolClosures">
            <div class="emergency-title">üè´ School Closures & Delays</div>
            <div class="emergency-content" id="schoolContent">Loading school information...</div>
        </div>

        <div class="emergency-section" id="roadConditions">
            <div class="emergency-title">üöó Road Conditions & Closures</div>
            <div class="emergency-content" id="roadContent">Loading road conditions...</div>
        </div>

        <div class="emergency-section" id="powerOutages">
            <div class="emergency-title">‚ö° Power Outage Information</div>
            <div class="emergency-content" id="powerContent">
                <div class="emergency-links">
                    <a href="https://outages.horryelectric.com/" target="_blank" class="emergency-link">‚ö° Horry Electric Outage Map</a>
                    <a href="https://stormcenter.santeecooper.com/" target="_blank" class="emergency-link">üîå Santee Cooper Outages</a>
                    <a href="https://www.duke-energy.com/outages" target="_blank" class="emergency-link">üí° Duke Energy Outages</a>
                </div>
            </div>
        </div>

        <div class="emergency-section" id="hurricaneCenter" style="display: none;">
            <div class="emergency-title">üåÄ National Hurricane Center</div>
            <div class="emergency-content">
                <div class="emergency-links">
                    <a href="https://www.nhc.noaa.gov/" target="_blank" class="emergency-link">üåÄ NHC Tropical Weather</a>
                    <a href="https://www.nhc.noaa.gov/cyclones/" target="_blank" class="emergency-link">üå™Ô∏è Active Storms</a>
                </div>
            </div>
        </div>

        <div class="emergency-section" id="emergencyLinks">
            <div class="emergency-title">üö® Emergency Resources</div>
            <div class="emergency-content">
                <div class="emergency-links">
                    <a href="https://www.horrycounty.org/Departments/Emergency-Management" target="_blank" class="emergency-link">üèõÔ∏è Horry County Emergency Management</a>
                    <a href="https://www.scemd.org/" target="_blank" class="emergency-link">üÜò SC Emergency Management</a>
                    <a href="https://www.weather.gov/ilm/" target="_blank" class="emergency-link">üå¶Ô∏è NWS Wilmington</a>
                </div>
            </div>
        </div>

        <section>
            <h2 class="section-title">Live Station Data - Hunters Ridge</h2>
            <div class="station-container">
                <iframe 
                    class="station-frame"
                    src="https://www.weatherlink.com/embeddablePage/show/90df5a38b06c485192fe5dc6bdf5204f/summary"
                    title="Live Weather Station Data">
                </iframe>
            </div>
        </section>

        <section>
            <h2 class="section-title">5-Day Forecast</h2>
            <div id="forecast" class="forecast-grid">
                <div class="loading">Loading forecast...</div>
            </div>
        </section>

        <section>
            <h2 class="section-title">Local Radar</h2>
            <div class="radar-container">
                <iframe 
                    class="radar-embed"
                    src="https://radar.weather.gov/?settings=v1_eyJhZ2VuZGEiOnsiaWQiOiJsb2NhbCIsImNlbnRlciI6Wy03OC45NzYsMzMuNzI1XSwibG9jYXRpb24iOm51bGwsInpvb20iOjh9LCJhbmltYXRpbmciOmZhbHNlLCJiYXNlIjoic3RhbmRhcmQiLCJhcnRjYyI6ZmFsc2UsImNvdW50eSI6ZmFsc2UsImN3YSI6ZmFsc2UsInJmYyI6ZmFsc2UsInN0YXRlIjpmYWxzZSwibWVudSI6dHJ1ZSwic2hvcnRGdXNlZE9ubHkiOmZhbHNlLCJvcGFjaXR5Ijp7ImFsZXJ0cyI6MC44LCJsb2NhbCI6MC42LCJsb2NhbFN0YXRpb25zIjowLjgsIm5hdGlvbmFsIjowLjZ9fQ%3D%3D"
                    title="Local Weather Radar">
                </iframe>
            </div>
        </section>

        <section>
            <h2 class="section-title">Astronomy & Tides</h2>
            <div id="astronomy" class="astronomy-strip">
                <div class="loading">Loading astronomy data...</div>
            </div>
        </section>

        <section style="background: white; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h2 class="section-title">About This Page</h2>
            <p style="margin-bottom: 1rem; line-height: 1.8;">This site provides weather analysis for Horry County and the Grand Strand based on global forecast models (GFS, Euro, Canadian) and ensemble data. I synthesize model trends with official National Weather Service and National Hurricane Center forecasts to give you clear, practical insights without the hype.</p>
            <p style="margin-bottom: 1rem; line-height: 1.8;">My personal weather station contributes data to the National Weather Service and Weather Underground networks.</p>
            <p style="font-size: 0.9rem; color: var(--text-medium); font-style: italic;">Christopher Jenkins | Amateur Radio Operator (KG4BTT) | SKYWARN Spotter | NHC support during major events | Climatology studies</p>
        </section>

        <div class="admin-toggle">
            <button class="admin-toggle-btn" onclick="toggleAdminPanel()">üîí Admin Login</button>
        </div>

        <div class="admin-panel" id="adminPanel">
            <div id="adminLogin" class="admin-login">
                <h3>Admin Access</h3>
                <input type="password" id="adminPassword" class="admin-input" placeholder="Enter password">
                <button class="admin-btn" onclick="checkPassword()">Login</button>
            </div>

            <div id="adminControls" class="admin-controls">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="font-family: 'Space Grotesk', sans-serif; font-size: 1.1rem;">Admin Controls</h3>
                    <button class="admin-btn" onclick="logout()">Logout</button>
                </div>

                <div class="admin-section">
                    <h4>Alert Banner</h4>
                    <select id="alertLevel" class="admin-select">
                        <option value="">No Alert / Use NWS Auto</option>
                        <option value="active">Red Warning</option>
                        <option value="warning">Orange Warning</option>
                        <option value="watch">Yellow Advisory</option>
                    </select>
                    <textarea id="alertMessage" class="admin-textarea" placeholder="Custom alert message (leave blank to use automatic NWS alerts)"></textarea>
                    <button class="admin-btn" onclick="saveAlert()">Update Alert</button>
                </div>

                <div class="admin-section">
                    <h4>Weather Commentary</h4>
                    <textarea id="adminCommentary" class="admin-textarea" placeholder="Your weather update..."></textarea>
                    <button class="admin-btn" onclick="saveCommentary()">Post Update</button>
                </div>
            </div>
        </div>

        <footer class="site-footer">
            <p class="last-updated" id="lastUpdated">Last updated: Loading...</p>
            <p>Data from WeatherLink & National Weather Service</p>
            <p style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-medium);">Weather analysis is for informational purposes only. Always follow official NWS warnings and local emergency management guidance.</p>
        </footer>
    </div>

    <script>
        const CONFIG = {
            lat: 33.72524,
            lon: -78.97603
        };

        window.addEventListener('DOMContentLoaded', () => {
            checkAdminSession();
            loadCommentary();
            loadWeatherData();
            setInterval(loadWeatherData, 5 * 60 * 1000);
        });

        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('active');
        }

        async function loadWeatherData() {
            await Promise.all([
                loadNWSAlerts(),
                loadForecast(),
                loadAstronomy(),
                loadQuickStats(),
                checkEmergencyConditions()
            ]);
            updateTimestamp();
        }

        async function loadQuickStats() {
            try {
                // Pull from Myrtle Beach International Airport (KMYR) - closest major airport with full weather reporting
                const obsResponse = await fetch(`https://api.weather.gov/stations/KMYR/observations/latest`);
                const obsData = await obsResponse.json();
                const props = obsData.properties;
                
                const tempC = props.temperature.value;
                const tempF = tempC ? Math.round((tempC * 9/5) + 32) : '--';
                const windMph = props.windSpeed.value ? Math.round(props.windSpeed.value * 0.621371) : '--';
                const conditions = props.textDescription || '--';
                
                document.getElementById('quickTemp').textContent = `${tempF}¬∞`;
                document.getElementById('quickConditions').textContent = conditions;
                document.getElementById('quickWind').textContent = `${windMph} mph`;
            } catch (error) {
                console.error('Quick stats error:', error);
                // Fallback display
                document.getElementById('quickTemp').textContent = '--¬∞';
                document.getElementById('quickConditions').textContent = '--';
                document.getElementById('quickWind').textContent = '-- mph';
            }
        }

        async function checkEmergencyConditions() {
            try {
                const response = await fetch(`https://api.weather.gov/alerts/active?point=${CONFIG.lat},${CONFIG.lon}`);
                const data = await response.json();
                
                const hasSevereWeather = data.features && data.features.some(alert => {
                    const severity = alert.properties.severity;
                    return severity === 'Extreme' || severity === 'Severe' || severity === 'Moderate';
                });
                
                if (hasSevereWeather) {
                    document.getElementById('powerOutages').classList.add('active');
                    document.getElementById('emergencyLinks').classList.add('active');
                    checkSchoolClosures();
                    checkRoadConditions();
                }
                
                // Check if it's hurricane season (June 1 - November 30)
                const today = new Date();
                const month = today.getMonth(); // 0-11
                if ((month >= 5 && month <= 10) && hasSevereWeather) { // June (5) through November (10)
                    document.getElementById('hurricaneCenter').style.display = 'block';
                }
            } catch (error) {
                console.error('Emergency check error:', error);
            }
        }

        async function checkSchoolClosures() {
            // Placeholder - would need actual Horry County Schools API
            // For now, show section but indicate manual check needed
            document.getElementById('schoolClosures').classList.add('active');
            document.getElementById('schoolContent').innerHTML = 
                'Check <a href="https://www.horrycountyschools.net/" target="_blank" style="color: var(--alert-red); text-decoration: underline;">Horry County Schools</a> for official closure information.';
        }

        async function checkRoadConditions() {
            // Placeholder - would need actual SC511 API
            document.getElementById('roadConditions').classList.add('active');
            document.getElementById('roadContent').innerHTML = 
                'Check <a href="https://www.511sc.org/" target="_blank" style="color: var(--alert-red); text-decoration: underline;">SC511.org</a> for current road conditions and closures.';
        }

        function shareWeather() {
            const url = window.location.href;
            const text = 'Check out the latest Horry County weather forecast and conditions';
            
            if (navigator.share) {
                navigator.share({ title: 'Horry County Weather', text: text, url: url })
                    .catch(err => console.log('Share failed', err));
            } else {
                const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                window.open(fbUrl, '_blank', 'width=600,height=400');
            }
        }

        async function loadNWSAlerts() {
            const customAlert = localStorage.getItem('customAlert');
            if (customAlert) {
                displayAlert(JSON.parse(customAlert));
                return;
            }

            try {
                const response = await fetch(`https://api.weather.gov/alerts/active?point=${CONFIG.lat},${CONFIG.lon}`);
                const data = await response.json();

                if (data.features && data.features.length > 0) {
                    const alert = data.features[0].properties;
                    let level = 'watch';
                    if (alert.severity === 'Extreme' || alert.severity === 'Severe') {
                        level = 'active';
                    } else if (alert.severity === 'Moderate') {
                        level = 'warning';
                    }

                    displayAlert({
                        level: level,
                        message: `‚ö†Ô∏è ${alert.event.toUpperCase()} - ${alert.headline}`
                    });
                } else {
                    document.getElementById('alertBanner').classList.remove('active');
                }
            } catch (error) {
                console.error('NWS alerts error:', error);
            }
        }

        async function loadForecast() {
            const container = document.getElementById('forecast');
            
            try {
                const response = await fetch(`https://api.weather.gov/points/${CONFIG.lat},${CONFIG.lon}`);
                const pointData = await response.json();
                const forecastUrl = pointData.properties.forecast;

                const forecastResponse = await fetch(forecastUrl);
                const forecastData = await forecastResponse.json();

                const periods = forecastData.properties.periods;
                
                // Group periods into days (day + night pairs)
                const days = [];
                for (let i = 0; i < Math.min(10, periods.length); i += 2) {
                    const day = periods[i];
                    const night = periods[i + 1];
                    
                    if (day && night) {
                        days.push({
                            name: day.name.replace(' Night', ''),
                            icon: day.isDaytime ? day.shortForecast : night.shortForecast,
                            high: day.temperature,
                            low: night.temperature,
                            desc: day.shortForecast
                        });
                    }
                }

                const weatherIcons = {
                    'Clear': '‚òÄÔ∏è', 'Sunny': '‚òÄÔ∏è', 'Mostly Clear': 'üå§Ô∏è', 'Partly Sunny': '‚õÖ',
                    'Partly Cloudy': '‚õÖ', 'Mostly Cloudy': '‚òÅÔ∏è', 'Cloudy': '‚òÅÔ∏è', 'Overcast': '‚òÅÔ∏è',
                    'Rain': 'üåßÔ∏è', 'Showers': 'üå¶Ô∏è', 'Thunderstorms': '‚õàÔ∏è', 'Snow': '‚ùÑÔ∏è',
                    'Fog': 'üå´Ô∏è', 'Windy': 'üí®', 'Sleet': 'üå®Ô∏è', 'Ice': 'üßä'
                };

                const getIcon = (desc) => {
                    for (let key in weatherIcons) {
                        if (desc.includes(key)) return weatherIcons[key];
                    }
                    return 'üå§Ô∏è';
                };

                container.innerHTML = days.slice(0, 5).map(day => `
                    <div class="forecast-card">
                        <div class="forecast-day">${day.name}</div>
                        <div class="forecast-icon">${getIcon(day.icon)}</div>
                        <div class="forecast-temps">
                            <span class="temp-high">${day.high}¬∞</span> / 
                            <span class="temp-low">${day.low}¬∞</span>
                        </div>
                        <div class="forecast-desc">${day.desc}</div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Forecast error:', error);
                container.innerHTML = '<div class="loading">Unable to load forecast</div>';
            }
        }

        function getMoonPhase() {
            const today = new Date();
            const knownNewMoon = new Date(2025, 0, 29);
            const daysSinceNew = (today - knownNewMoon) / (1000 * 60 * 60 * 24);
            const lunarCycle = 29.53;
            const phase = ((daysSinceNew % lunarCycle) + lunarCycle) % lunarCycle;
            
            if (phase < 1.84) return { icon: 'üåë', name: 'New Moon' };
            if (phase < 7.38) return { icon: 'üåí', name: 'Waxing Crescent' };
            if (phase < 9.23) return { icon: 'üåì', name: 'First Quarter' };
            if (phase < 14.77) return { icon: 'üåî', name: 'Waxing Gibbous' };
            if (phase < 16.61) return { icon: 'üåï', name: 'Full Moon' };
            if (phase < 22.15) return { icon: 'üåñ', name: 'Waning Gibbous' };
            if (phase < 23.99) return { icon: 'üåó', name: 'Last Quarter' };
            return { icon: 'üåò', name: 'Waning Crescent' };
        }

        async function loadAstronomy() {
            const container = document.getElementById('astronomy');
            
            try {
                const sunResponse = await fetch(`https://api.sunrise-sunset.org/json?lat=${CONFIG.lat}&lng=${CONFIG.lon}&formatted=0`);
                const sunData = await sunResponse.json();

                const sunrise = new Date(sunData.results.sunrise).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                const sunset = new Date(sunData.results.sunset).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

                const moon = getMoonPhase();

                container.innerHTML = `
                    <div class="astro-item">
                        <span class="astro-icon">‚òÄÔ∏è</span>
                        <span class="astro-label">Sunrise:</span>
                        <span class="astro-value">${sunrise}</span>
                    </div>
                    <div style="color: var(--border);">|</div>
                    <div class="astro-item">
                        <span class="astro-icon">üåÖ</span>
                        <span class="astro-label">Sunset:</span>
                        <span class="astro-value">${sunset}</span>
                    </div>
                    <div style="color: var(--border);">|</div>
                    <div class="astro-item">
                        <span class="astro-icon">${moon.icon}</span>
                        <span class="astro-value">${moon.name}</span>
                    </div>
                    <div style="color: var(--border);">|</div>
                    <div class="astro-item">
                        <span class="astro-icon">üåä</span>
                        <a href="https://www.tide-forecast.com/locations/Myrtle-Beach-South-Carolina/tides/latest" target="_blank" class="astro-link">MB Tides ‚Üí</a>
                    </div>
                `;

            } catch (error) {
                console.error('Astronomy error:', error);
                const moon = getMoonPhase();
                container.innerHTML = `
                    <div class="astro-item">
                        <span class="astro-icon">${moon.icon}</span>
                        <span class="astro-value">${moon.name}</span>
                    </div>
                    <div style="color: var(--border);">|</div>
                    <div class="astro-item">
                        <span class="astro-icon">üåä</span>
                        <a href="https://www.tide-forecast.com/locations/Myrtle-Beach-South-Carolina/tides/latest" target="_blank" class="astro-link">MB Tides ‚Üí</a>
                    </div>
                `;
            }
        }

        function updateTimestamp() {
            document.getElementById('lastUpdated').textContent = 
                `Last updated: ${new Date().toLocaleString()}`;
        }

        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'weather2024') {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminControls();
            } else {
                alert('Incorrect password');
            }
        }

        function checkAdminSession() {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('adminPanel').classList.add('active');
                showAdminControls();
            }
        }

        function showAdminControls() {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminControls').classList.add('active');
            loadAdminValues();
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminControls').classList.remove('active');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPanel').classList.remove('active');
        }

        function loadAdminValues() {
            const alert = JSON.parse(localStorage.getItem('customAlert') || '{}');
            if (alert.level) {
                document.getElementById('alertLevel').value = alert.level;
                document.getElementById('alertMessage').value = alert.message || '';
            }

            const commentary = JSON.parse(localStorage.getItem('commentary') || '{}');
            if (commentary.text) {
                document.getElementById('adminCommentary').value = commentary.text;
            }
        }

        function saveAlert() {
            const level = document.getElementById('alertLevel').value;
            const message = document.getElementById('alertMessage').value.trim();
            
            if (!level) {
                localStorage.removeItem('customAlert');
                loadNWSAlerts();
                alert('Alert cleared - now using automatic NWS alerts');
                return;
            }

            if (level && !message) {
                alert('Please enter an alert message or select "No Alert" to use NWS auto alerts');
                return;
            }
            
            const alertData = { level, message };
            localStorage.setItem('customAlert', JSON.stringify(alertData));
            displayAlert(alertData);
            alert('Alert updated!');
        }

        function saveCommentary() {
            const text = document.getElementById('adminCommentary').value.trim();
            if (!text) {
                alert('Please enter commentary text');
                return;
            }

            const commentary = {
                text: text,
                timestamp: new Date().toLocaleString()
            };

            localStorage.setItem('commentary', JSON.stringify(commentary));
            displayCommentary(commentary);
            alert('Commentary posted!');
        }

        function loadCommentary() {
            const saved = localStorage.getItem('commentary');
            if (saved) {
                displayCommentary(JSON.parse(saved));
            }
        }

        function displayCommentary(commentary) {
            document.getElementById('commentaryTime').textContent = `Posted: ${commentary.timestamp}`;
            document.getElementById('commentaryText').textContent = commentary.text;
            document.getElementById('commentaryDisplay').classList.add('active');
            document.getElementById('noCommentary').style.display = 'none';
        }

        function displayAlert(alert) {
            const banner = document.getElementById('alertBanner');
            banner.textContent = alert.message;
            banner.className = 'alert-banner active ' + alert.level;
        }
    </script>
</body>
</html>
